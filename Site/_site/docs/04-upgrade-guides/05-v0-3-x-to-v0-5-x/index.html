<!DOCTYPE html>
<html lang="en-US">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>v0.3.X to v0.5.X | ILGPU - A Modern GPU Compiler for .Net Programs</title>
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="v0.3.X to v0.5.X" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="ArrayViews and VariableViews" />
<meta property="og:description" content="ArrayViews and VariableViews" />
<link rel="canonical" href="http://localhost:4000/docs/04-upgrade-guides/05-v0-3-x-to-v0-5-x/" />
<meta property="og:url" content="http://localhost:4000/docs/04-upgrade-guides/05-v0-3-x-to-v0-5-x/" />
<meta property="og:site_name" content="ILGPU - A Modern GPU Compiler for .Net Programs" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-08-18T23:46:02-04:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="v0.3.X to v0.5.X" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-08-18T23:46:02-04:00","datePublished":"2023-08-18T23:46:02-04:00","description":"ArrayViews and VariableViews","headline":"v0.3.X to v0.5.X","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/docs/04-upgrade-guides/05-v0-3-x-to-v0-5-x/"},"url":"http://localhost:4000/docs/04-upgrade-guides/05-v0-3-x-to-v0-5-x/"}</script>
<!-- End Jekyll SEO tag -->
<!-- ARSHA Fonts -->
    <link href="/assets/css/fonts.css" rel="stylesheet">
    <!-- ARSHA Fonts -->

    <!-- ARSHA Vendor CSS Files -->
    <link href="/assets/vendor/aos/aos.css" rel="stylesheet">
    <link href="/assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
    <link href="/assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
    <link href="/assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
    <link href="/assets/vendor/remixicon/remixicon.css" rel="stylesheet">
    <link href="/assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">
    <!-- ARSHA Vendor CSS Files -->

    <!-- Normalize CSS -->
    <link rel="stylesheet" href="/assets/css/normalize.css">
    <!-- Normalize CSS -->

    <!-- ARSHA Template Main CSS File -->
    <link rel="stylesheet"
          href="/assets/css/sass.css">
    <!-- ARSHA Template Main CSS File -->

    <!-- custom CSS Files -->
    <link rel="stylesheet" href="/assets/css/custom.css">
    <!-- custom CSS Files --><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="ILGPU - A Modern GPU Compiler for .Net Programs" /><!-- Favicons -->
<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicon/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicon/site.webmanifest">
<link rel="mask-icon" href="/assets/img/favicon/safari-pinned-tab.svg" color="#5bbad5">
<link rel="shortcut icon" href="/assets/img/favicon/favicon.ico">
<meta name="msapplication-TileColor" content="#2b5797">
<meta name="msapplication-config" content="/assets/img/favicon/browserconfig.xml">
<meta name="theme-color" content="#ffffff">
<!-- Favicons -->

<!-- Extras CSS -->
<link rel="stylesheet" href="/assets/css/site.css">
<!-- Extras CSS -->

        <!-- Code Highlighting -->
<link rel="stylesheet" href="/assets/vendor/prism/prism.css">
<!-- Code Highlighting -->

<!-- Extras CSS -->
<link rel="stylesheet" href="/assets/css/doc.css">

<!-- Extras CSS -->

    

    

</head>


<body>











<header id="header" class="fixed-top">
    <div class="container d-flex align-items-center">

        <a href="/" class="logo me-auto"></a>

        <nav id="navbar" class="navbar">
            <ul>
                <li class="dropdown">
                    <a href="#" class=""><span>About</span> <i
                                class="bi bi-chevron-down"></i></a>
                    <ul>
                        <li><a href="/#learn-more" class="scrollto">Learn More</a></li>
                        <li><a href="/#highlights" class="scrollto">Highlights</a></li>
                        <li><a href="/#features" class="scrollto">Features</a></li>
                        <li><a href="/#news" class="scrollto">News</a></li>
                        <li><a href="/#faq" class="scrollto">FAQ</a></li>
                    </ul>
                </li>

                <li class="dropdown">
                    <a href="#"
                       class=""><span>Project</span>
                        <i class="bi bi-chevron-down"></i></a>
                    <ul>
                        <li><a target="_blank" href="https://github.com/m4rs-mt/ILGPU">Sourcecode</a></li>
                        <li><a href="/releases/">Releases</a></li>
                        <li><a href="/milestones/">Milestones</a></li>
                    </ul>
                </li>

                <li><a class="nav-link active"
                       href="/docs/">Documentation</a></li>
                <li><a class="nav-link" target="_blank" href="https://discord.com/invite/X6RBCff">Discord</a></li>
                <li><a class="getstarted scrollto" href="/#cta">Get Started</a></li>
            </ul>
            <i class="bi bi-list mobile-nav-toggle"></i>
        </nav>
    </div>
</header><!-- End Header -->



<!-- ======= Sidebar Section ======= -->
<section id="sidebar">
    <div id="sidebar-header">
        
        
            <div class="container">
                <div class="row">
                    <a href="/docs/" class="col-9 my-auto"><h4 class="mb-0">Documentation</h4></a>
                    <svg xmlns="http://www.w3.org/2000/svg" id="sidebar-collapse-icon" class="icon icon-tabler icon-tabler-chevron-left text-white col-3 my-auto" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                        <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                        <path d="M15 6l-6 6l6 6"></path>
                    </svg>
                </div>
            </div>
        
    </div>

    
        <div id="search" class="ms-4 mb-4">
            <input type="search" class="typeahead form-control" placeholder="Search..." aria-label="Search" size="18" />
        </div>
    

    <nav id="wiki-nav">
        
        
            <div class="section">
                <h5>Primers</h5>
                <ul>
                    
                        
                        
                            
                            
                            <li><a href="/docs/01-primers/01-setting-up-ilgpu/"
                                   >Setting Up ILGPU</a></li>
                        
                    
                        
                        
                            
                            
                            <li><a href="/docs/01-primers/02-a-gpu-is-not-a-cpu/"
                                   >A GPU Is Not A CPU</a></li>
                        
                    
                        
                        
                            
                            
                            <li><a href="/docs/01-primers/03-memory-and-bandwidth-threads/"
                                   >Memory & Bandwidth Threads</a></li>
                        
                    
                </ul>
            </div>
        
            <div class="section">
                <h5>Beginner</h5>
                <ul>
                    
                        
                        
                            
                            
                            <li><a href="/docs/02-beginner/01-context-and-accelerators/"
                                   >Context & Accelerators</a></li>
                        
                    
                        
                        
                            
                            
                            <li><a href="/docs/02-beginner/02-memorybuffers-and-arrayviews/"
                                   >MemoryBuffers & ArrayViews</a></li>
                        
                    
                        
                        
                            
                            
                            <li><a href="/docs/02-beginner/03-kernels-and-simple-programs/"
                                   >Kernels & Simple Programs</a></li>
                        
                    
                        
                        
                            
                            
                            <li><a href="/docs/02-beginner/04-structs/"
                                   >Structs</a></li>
                        
                    
                </ul>
            </div>
        
            <div class="section">
                <h5>Advanced</h5>
                <ul>
                    
                        
                        
                            
                            
                            <li><a href="/docs/03-advanced/01-memory-buffers-and-views/"
                                   >Memory Buffers & Views</a></li>
                        
                    
                        
                        
                            
                            
                            <li><a href="/docs/03-advanced/02-kernels/"
                                   >Kernels</a></li>
                        
                    
                        
                        
                            
                            
                            <li><a href="/docs/03-advanced/03-shared-memory/"
                                   >Shared Memory</a></li>
                        
                    
                        
                        
                            
                            
                            <li><a href="/docs/03-advanced/04-math-functions/"
                                   >Math Functions</a></li>
                        
                    
                        
                        
                            
                            
                            <li><a href="/docs/03-advanced/05-dynamically-specialized-kernels/"
                                   >Dynamically Specialized Kernels</a></li>
                        
                    
                        
                        
                            
                            
                            <li><a href="/docs/03-advanced/06-debugging-and-profiling/"
                                   >Debugging & Profiling</a></li>
                        
                    
                        
                        
                            
                            
                            <li><a href="/docs/03-advanced/07-inside-ilgpu/"
                                   >Inside ILGPU</a></li>
                        
                    
                </ul>
            </div>
        
            <div class="section">
                <h5>Upgrade Guides</h5>
                <ul>
                    
                        
                        
                            
                            
                            <li><a href="/docs/04-upgrade-guides/01-v0-8-x-to-v0-9-x/"
                                   >v0.8.X to v0.9.X</a></li>
                        
                    
                        
                        
                            
                            
                            <li><a href="/docs/04-upgrade-guides/02-v0-8-0-to-v0-8-1/"
                                   >v0.8.0 to v0.8.1</a></li>
                        
                    
                        
                        
                            
                            
                            <li><a href="/docs/04-upgrade-guides/03-v0-7-x-to-v0-8-x/"
                                   >v0.7.X to v0.8.X</a></li>
                        
                    
                        
                        
                            
                            
                            <li><a href="/docs/04-upgrade-guides/04-v0-6-x-to-v0-7-x/"
                                   >v0.6.X to v0.7.X</a></li>
                        
                    
                        
                        
                            
                            
                            <li><a href="/docs/04-upgrade-guides/05-v0-3-x-to-v0-5-x/"
                                   class="text-white">v0.3.X to v0.5.X</a></li>
                        
                    
                        
                        
                            
                            
                            <li><a href="/docs/04-upgrade-guides/06-v0-1-x-to-v0-2-x/"
                                   >v0.1.X to v0.2.X</a></li>
                        
                    
                </ul>
            </div>
        
        <ul>
            
        </ul>
    </nav>

    
</section><!-- End Sidebar Section -->


<main id="main">
    


<!-- ======= Breadcrumbs ======= -->
<section id="breadcrumbs" class="breadcrumbs">
    <div class="container">
        <ol>
            <li><a href="/">Home</a></li>
            <li>v0.3.X to v0.5.X</li>
        </ol>
        <h2>v0.3.X to v0.5.X</h2>
    </div>
</section><!-- End Breadcrumbs -->


    
        <!-- ======= Inner Page Section ======= -->
        <section id="wiki-main" class="inner-page collapsed">
            <div class="container-fluid">
                <h2 id="arrayviews-and-variableviews">ArrayViews and VariableViews</h2>

<p>The <code class="language-plaintext highlighter-rouge">ArrayView</code> and <code class="language-plaintext highlighter-rouge">VariableView</code> structures have been adapted to the C# ‘ref’ features.
This renders explicit <code class="language-plaintext highlighter-rouge">Load</code> and <code class="language-plaintext highlighter-rouge">Store</code> methods obsolete.
In addition, all methods that accept <code class="language-plaintext highlighter-rouge">VariableView&lt;X&gt;</code> parameter types have been adapted to the parameter types <code class="language-plaintext highlighter-rouge">ref X</code>.
This applies, for example, to all methods of the class <code class="language-plaintext highlighter-rouge">Atomic</code>.</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="err">...</span>
<span class="err">{</span>
    <span class="nc">static</span> <span class="k">void</span> <span class="p">...(...)</span>
    <span class="p">{</span>
        <span class="c1">// Old way (obsolete and no longer supported)</span>
        <span class="n">ArrayView</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">someView</span> <span class="p">=</span> <span class="p">...</span>
        <span class="kt">var</span> <span class="n">variableView</span> <span class="p">=</span> <span class="n">someView</span><span class="p">.</span><span class="nf">GetVariableView</span><span class="p">(</span><span class="n">X</span><span class="p">);</span>
        <span class="n">Atomic</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">variableView</span><span class="p">);</span>
        <span class="p">...</span>
        <span class="n">variableView</span><span class="p">.</span><span class="nf">Store</span><span class="p">(</span><span class="m">42</span><span class="p">);</span>

        <span class="c1">// New way</span>
        <span class="n">ArrayView</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">someView</span> <span class="p">=</span> <span class="p">...</span>
        <span class="n">Atomic</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">ref</span> <span class="n">someView</span><span class="p">[</span><span class="n">X</span><span class="p">]);</span>
        <span class="p">...</span>
        <span class="n">someView</span><span class="p">[</span><span class="n">X</span><span class="p">]</span> <span class="p">=</span> <span class="m">42</span><span class="p">;</span>

        <span class="c1">// or</span>
        <span class="k">ref</span> <span class="kt">var</span> <span class="n">variable</span> <span class="p">=</span> <span class="k">ref</span> <span class="n">someView</span><span class="p">[</span><span class="n">X</span><span class="p">];</span>
        <span class="n">variable</span> <span class="p">=</span> <span class="m">42</span><span class="p">;</span>

        <span class="c1">// or</span>
        <span class="kt">var</span> <span class="n">variableView</span> <span class="p">=</span> <span class="n">someView</span><span class="p">.</span><span class="nf">GetVariableView</span><span class="p">(</span><span class="n">X</span><span class="p">);</span>
        <span class="n">variableView</span><span class="p">.</span><span class="n">Value</span> <span class="p">=</span> <span class="m">42</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="shared-memory">Shared Memory</h2>

<p>The general concept of shared memory has been redesigned.
The previous model required <code class="language-plaintext highlighter-rouge">SharedMemoryAttribute</code> attributes on specific parameters that should be allocated in shared
memory.
The new model uses the static class <code class="language-plaintext highlighter-rouge">SharedMemory</code> to allocate this kind of memory procedurally in the scope of kernels.
This simplifies programming, kernel-delegate creation and enables non-kernel methods to allocate their own pool of
shared memory.</p>

<p>Note that array lengths must be constants in this ILGPU version.
Hence, a dynamic allocation of shared memory is currently not supported.</p>

<p>The kernel loader methods <code class="language-plaintext highlighter-rouge">LoadSharedMemoryKernelX</code> and <code class="language-plaintext highlighter-rouge">LoadSharedMemoryStreamKernelX</code> have been removed.
They are no longer required, since a kernel does not have to declare its shared memory allocations in the form of
additional parameters.</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="err">...</span>
<span class="err">{</span>
    <span class="nc">static</span> <span class="k">void</span> <span class="nf">SharedMemoryKernel</span><span class="p">(</span><span class="n">GroupedIndex</span> <span class="n">index</span><span class="p">,</span> <span class="p">...)</span>
    <span class="p">{</span>
        <span class="c1">// Allocate an array of 32 integers</span>
        <span class="n">ArrayView</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">sharedMemoryArray</span> <span class="p">=</span> <span class="n">SharedMemory</span><span class="p">.</span><span class="n">Allocate</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;(</span><span class="m">32</span><span class="p">);</span>

        <span class="c1">// Allocate a single variable of type long in shared memory</span>
        <span class="k">ref</span> <span class="kt">long</span> <span class="n">sharedMemoryVariable</span> <span class="p">=</span> <span class="k">ref</span> <span class="n">SharedMemory</span><span class="p">.</span><span class="n">Allocate</span><span class="p">&lt;</span><span class="kt">long</span><span class="p">&gt;();</span>

        <span class="p">...</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="cpu-debugging">CPU Debugging</h2>

<p>Starting a kernel in debug mode is a common task that developers go through many times a day.
Although ILGPU has been optimized for performance, you may not wait a few milliseconds every time you start your program
to debug a kernel on the CPU.
For this reason, the context flag <code class="language-plaintext highlighter-rouge">ContextFlags.SkipCPUCodeGeneration</code> has been added.
It suppresses IR code generation for CPU kernels and uses the .Net runtime directly.
<em>Warning: This avoids general kernel analysis/verification checks. It should only be used by experienced users.</em></p>

<h2 id="internals">Internals</h2>

<p>The old LLVM-based concept of <code class="language-plaintext highlighter-rouge">CompileUnit</code> objects is obsolete and has been replaced by a completely new IR.
The new IR leverages <code class="language-plaintext highlighter-rouge">IRContext</code> objects to manage IR objects that are derived from the class <code class="language-plaintext highlighter-rouge">ILGPU.IR.Node</code>.
Unlike previous versions, an <code class="language-plaintext highlighter-rouge">IRContext</code> is not tied to a specific <code class="language-plaintext highlighter-rouge">Backend</code> instance and can be reused accross
different hardware architectures.</p>

<p>The global optimization process can be controlled with the enumeration <code class="language-plaintext highlighter-rouge">OptimizationLevel</code>.
This level can be specified by passing the desired level to the <code class="language-plaintext highlighter-rouge">ILGPU.Context</code> constructor.
If the optimization level is not explicitly specified, the level is determined by the current build mode (either <code class="language-plaintext highlighter-rouge">Debug</code>
or <code class="language-plaintext highlighter-rouge">Release</code>).</p>


                
    <div class="f5 contribution">
        <h2>Help us make these docs great!</h2>
        <p>All ILGPU docs are open source. See something that's wrong or unclear? Submit a
            pull request.</p>
        <a class="btn"
           href="https://github.com/m4rs-mt/ILGPU/edit/master/Docs/04_Upgrade-Guides/05_v0.3.X-to-v0.5.X.md"
           target="_blank" rel="noopener">
            <svg aria-hidden="true" role="img" class="octicon mr-1" viewBox="0 0 16 16" width="16" height="16"
                 fill="currentColor"
                 style="display:inline-block;user-select:none;vertical-align:text-bottom;overflow:visible">
                <path fill-rule="evenodd"
                      d="M7.177 3.073L9.573.677A.25.25 0 0110 .854v4.792a.25.25 0 01-.427.177L7.177 3.427a.25.25 0 010-.354zM3.75 2.5a.75.75 0 100 1.5.75.75 0 000-1.5zm-2.25.75a2.25 2.25 0 113 2.122v5.256a2.251 2.251 0 11-1.5 0V5.372A2.25 2.25 0 011.5 3.25zM11 2.5h-1V4h1a1 1 0 011 1v5.628a2.251 2.251 0 101.5 0V5A2.5 2.5 0 0011 2.5zm1 10.25a.75.75 0 111.5 0 .75.75 0 01-1.5 0zM3.75 12a.75.75 0 100 1.5.75.75 0 000-1.5z"></path>
            </svg>
            Make a contribution</a>
        <p class="color-fg-muted f6 mt-2">Or,<!-- --> <a
                    href="https://github.com/m4rs-mt/ILGPU#general-contribution-guidelines"
                    target="_blank" rel="noopener">learn how to contribute.</a>
        </p>
    </div>


            </div>
        </section><!-- End Inner Page Section -->
    
</main><!-- End #main -->
<!-- ======= Footer ======= -->
<footer id="footer">
    <div class="container footer-bottom clearfix text-center">
        <div>
            &copy; Copyright
            <script type="text/javascript">document.write(String(new Date().getFullYear()));</script>
            <strong><span>ILGPU</span></strong>. All Rights Reserved.
        </div>
        
        
        
    </div>
</footer><!-- End Footer -->

<div id="preloader"></div>
<!-- loading Spinner -->

<a href="#" class="back-to-top d-flex align-items-center justify-content-center">
    <i class="bi bi-arrow-up-short"></i>
</a>
<!-- Go to Top button -->

<!-- ARSHA Vendor JS Files -->
<script defer src="/assets/vendor/aos/aos.js"></script>
<script defer src="/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script defer src="/assets/vendor/glightbox/js/glightbox.min.js"></script>
<script defer src="/assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
<script defer src="/assets/vendor/swiper/swiper-bundle.min.js"></script>
<script defer src="/assets/vendor/waypoints/noframework.waypoints.js"></script>
<script defer src="/assets/vendor/php-email-form/validate.js"></script>
<!-- ARSHA Vendor JS Files -->

<!-- ARSHA Template Main JS File -->
<script defer src="/assets/js/main.js"></script>
<!-- ARSHA Template Main JS File -->

    <!-- Dark Theme -->

<!-- Dark Theme -->

<!-- Search Feature -->

    <script defer src="/assets/vendor/jquery/jquery-3.6.0.min.js"></script>
    <script defer src="/assets/vendor/typeahead/typeahead.bundle.js"></script>
    <script defer src="/assets/vendor/lunr/lunr.js"></script>
    <script defer src="/assets/js/search.js"></script>
    <script defer src="/assets/js/sidebar-collapse.js"></script>

<!-- Search Feature -->

<!-- Code Highlighting -->
<script defer src="/assets/vendor/highlight/highlight.min.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        hljs.highlightAll();
    })
</script>
<script defer src="/assets/vendor/prism/prism.js"></script>
<!-- Code Highlighting -->





</body>

</html>
